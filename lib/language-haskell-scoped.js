"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Atom = require("atom");
const editor_controller_1 = require("./editor-controller");
let resolveCB;
let cbPromise;
let disposables;
function activate() {
    resolveCB = undefined;
    const bprom = (cbPromise = new Promise((resolve) => (resolveCB = resolve)));
    const bdisp = (disposables = new Atom.CompositeDisposable());
    disposables.add(atom.workspace.observeTextEditors(async (ed) => {
        if (editor_controller_1.EditorController.shouldActivate(ed)) {
            bdisp.add(new editor_controller_1.EditorController(ed, await bprom));
        }
    }));
}
exports.activate = activate;
function deactivate() {
    resolveCB = undefined;
    cbPromise = undefined;
    disposables && disposables.dispose();
    disposables = undefined;
}
exports.deactivate = deactivate;
function consumeCompBack(service) {
    resolveCB && resolveCB(service);
}
exports.consumeCompBack = consumeCompBack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFuZ3VhZ2UtaGFza2VsbC1zY29wZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbGFuZ3VhZ2UtaGFza2VsbC1zY29wZWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNEI7QUFDNUIsMkRBQXNEO0FBR3RELElBQUksU0FBMEQsQ0FBQTtBQUM5RCxJQUFJLFNBQWtELENBQUE7QUFDdEQsSUFBSSxXQUFpRCxDQUFBO0FBRXJEO0lBQ0UsU0FBUyxHQUFHLFNBQVMsQ0FBQTtJQUNyQixNQUFNLEtBQUssR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQzNFLE1BQU0sS0FBSyxHQUFHLENBQUMsV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQTtJQUM1RCxXQUFXLENBQUMsR0FBRyxDQUNiLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFO1FBQzdDLElBQUksb0NBQWdCLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3ZDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxvQ0FBZ0IsQ0FBQyxFQUFFLEVBQUUsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFBO1NBQ2pEO0lBQ0gsQ0FBQyxDQUFDLENBQ0gsQ0FBQTtBQUNILENBQUM7QUFYRCw0QkFXQztBQUVEO0lBQ0UsU0FBUyxHQUFHLFNBQVMsQ0FBQTtJQUNyQixTQUFTLEdBQUcsU0FBUyxDQUFBO0lBQ3JCLFdBQVcsSUFBSSxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDcEMsV0FBVyxHQUFHLFNBQVMsQ0FBQTtBQUN6QixDQUFDO0FBTEQsZ0NBS0M7QUFFRCx5QkFBZ0MsT0FBMkI7SUFDekQsU0FBUyxJQUFJLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUNqQyxDQUFDO0FBRkQsMENBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBdG9tIGZyb20gJ2F0b20nXG5pbXBvcnQgeyBFZGl0b3JDb250cm9sbGVyIH0gZnJvbSAnLi9lZGl0b3ItY29udHJvbGxlcidcbmltcG9ydCB7IElDb21wbGV0aW9uQmFja2VuZCB9IGZyb20gJ2F0b20taGFza2VsbC11cGkvY29tcGxldGlvbi1iYWNrZW5kJ1xuXG5sZXQgcmVzb2x2ZUNCOiAoKHZhbDogSUNvbXBsZXRpb25CYWNrZW5kKSA9PiB2b2lkKSB8IHVuZGVmaW5lZFxubGV0IGNiUHJvbWlzZTogUHJvbWlzZTxJQ29tcGxldGlvbkJhY2tlbmQ+IHwgdW5kZWZpbmVkXG5sZXQgZGlzcG9zYWJsZXM6IEF0b20uQ29tcG9zaXRlRGlzcG9zYWJsZSB8IHVuZGVmaW5lZFxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gIHJlc29sdmVDQiA9IHVuZGVmaW5lZFxuICBjb25zdCBicHJvbSA9IChjYlByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gKHJlc29sdmVDQiA9IHJlc29sdmUpKSlcbiAgY29uc3QgYmRpc3AgPSAoZGlzcG9zYWJsZXMgPSBuZXcgQXRvbS5Db21wb3NpdGVEaXNwb3NhYmxlKCkpXG4gIGRpc3Bvc2FibGVzLmFkZChcbiAgICBhdG9tLndvcmtzcGFjZS5vYnNlcnZlVGV4dEVkaXRvcnMoYXN5bmMgKGVkKSA9PiB7XG4gICAgICBpZiAoRWRpdG9yQ29udHJvbGxlci5zaG91bGRBY3RpdmF0ZShlZCkpIHtcbiAgICAgICAgYmRpc3AuYWRkKG5ldyBFZGl0b3JDb250cm9sbGVyKGVkLCBhd2FpdCBicHJvbSkpXG4gICAgICB9XG4gICAgfSksXG4gIClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7XG4gIHJlc29sdmVDQiA9IHVuZGVmaW5lZFxuICBjYlByb21pc2UgPSB1bmRlZmluZWRcbiAgZGlzcG9zYWJsZXMgJiYgZGlzcG9zYWJsZXMuZGlzcG9zZSgpXG4gIGRpc3Bvc2FibGVzID0gdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25zdW1lQ29tcEJhY2soc2VydmljZTogSUNvbXBsZXRpb25CYWNrZW5kKSB7XG4gIHJlc29sdmVDQiAmJiByZXNvbHZlQ0Ioc2VydmljZSlcbn1cbiJdfQ==